function js_beautify(d,s){var a,w,o,G,k,u,O,Q,P;var z,L,g,m,q,N;var E,J,x,y,h,e;var r;var s=s||{};var B=s.indent_size||4;var j=s.indent_char||" ";var I=typeof s.preserve_newlines==="undefined"?true:s.preserve_newlines;var M=s.indent_level||0;function p(){while(w.length&&(w[w.length-1]===" "||w[w.length-1]===P)){w.pop()}}function v(R){R=typeof R==="undefined"?true:R;e=false;p();if(!w.length){return}if(w[w.length-1]!=="\n"||!R){w.push("\n")}for(var t=0;t<r;t++){w.push(P)}}function i(){var t=w.length?w[w.length-1]:" ";if(t!==" "&&t!=="\n"&&t!==P){w.push(" ")}}function A(){w.push(o)}function n(){r++}function F(){if(r){r--}}function D(){if(w.length&&w[w.length-1]===P){w.pop()}}function l(t){Q.push(O);O=t}function f(){x=O==="DO_BLOCK";O=Q.pop()}function C(S,t){for(var R=0;R<t.length;R++){if(t[R]===S){return true}}return false}function K(){var X=0;var V="";do{if(m>=a.length){return["","TK_EOF"]}V=a.charAt(m);m+=1;if(V==="\n"){X+=1}}while(C(V,z));var W=false;if(I){if(X>1){for(var S=0;S<2;S++){v(S===0)}}W=(X===1)}if(C(V,L)){if(m<a.length){while(C(a.charAt(m),L)){V+=a.charAt(m);m+=1;if(m===a.length){break}}}if(m!==a.length&&V.match(/^[0-9]+[Ee]$/)&&a.charAt(m)==="-"){m+=1;var Y=K(m);V+="-"+Y[0];return[V,"TK_WORD"]}if(V==="in"){return[V,"TK_OPERATOR"]}if(W&&G!=="TK_OPERATOR"&&!e){v()}return[V,"TK_WORD"]}if(V==="("||V==="["){return[V,"TK_START_EXPR"]}if(V===")"||V==="]"){return[V,"TK_END_EXPR"]}if(V==="{"){return[V,"TK_START_BLOCK"]}if(V==="}"){return[V,"TK_END_BLOCK"]}if(V===";"){return[V,"TK_SEMICOLON"]}if(V==="/"){var T="";if(a.charAt(m)==="*"){m+=1;if(m<a.length){while(!(a.charAt(m)==="*"&&a.charAt(m+1)&&a.charAt(m+1)==="/")&&m<a.length){T+=a.charAt(m);m+=1;if(m>=a.length){break}}}m+=2;return["/*"+T+"*/","TK_BLOCK_COMMENT"]}if(a.charAt(m)==="/"){T=V;while(a.charAt(m)!=="\x0d"&&a.charAt(m)!=="\x0a"){T+=a.charAt(m);m+=1;if(m>=a.length){break}}m+=1;if(W){v()}return[T,"TK_COMMENT"]}}if(V==="'"||V==='"'||(V==="/"&&((G==="TK_WORD"&&k==="return")||(G==="TK_START_EXPR"||G==="TK_END_BLOCK"||G==="TK_OPERATOR"||G==="TK_EOF"||G==="TK_SEMICOLON")))){var Z=V;var U=false;var R="";if(m<a.length){while(U||a.charAt(m)!==Z){R+=a.charAt(m);if(!U){U=a.charAt(m)==="\\"}else{U=false}m+=1;if(m>=a.length){break}}}m+=1;R=Z+R+Z;if(Z=="/"){while(m<a.length&&C(a.charAt(m),L)){R+=a.charAt(m);m+=1}}return[R,"TK_STRING"]}if(C(V,g)){while(m<a.length&&C(V+a.charAt(m),g)){V+=a.charAt(m);m+=1;if(m>=a.length){break}}return[V,"TK_OPERATOR"]}return[V,"TK_UNKNOWN"]}P="";while(B--){P+=j}r=M;a=d;u="";G="TK_START_EXPR";k="";w=[];x=false;y=false;h=false;z="\n\r\t ".split("");L="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");g="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::".split(" ");q="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");O="BLOCK";Q=[O];m=0;N=false;while(true){var H=K(m);o=H[0];J=H[1];if(J==="TK_EOF"){break}switch(J){case"TK_START_EXPR":y=false;l("EXPRESSION");if(k===";"){v()}else{if(G==="TK_END_EXPR"||G==="TK_START_EXPR"){}else{if(G!=="TK_WORD"&&G!=="TK_OPERATOR"){i()}else{if(C(u,q)&&u!=="function"){i()}}}}A();break;case"TK_END_EXPR":A();f();break;case"TK_START_BLOCK":if(u==="do"){l("DO_BLOCK")}else{l("BLOCK")}if(G!=="TK_OPERATOR"&&G!=="TK_START_EXPR"){if(G==="TK_START_BLOCK"){v()}else{i()}}A();n();break;case"TK_END_BLOCK":if(G==="TK_START_BLOCK"){p();F()}else{F();v()}A();f();break;case"TK_WORD":if(x){i();A();i();break}if(o==="case"||o==="default"){if(k===":"){D()}else{F();v();n()}A();N=true;break}E="NONE";if(G==="TK_END_BLOCK"){if(!C(o.toLowerCase(),["else","catch","finally"])){E="NEWLINE"}else{E="SPACE";i()}}else{if(G==="TK_SEMICOLON"&&(O==="BLOCK"||O==="DO_BLOCK")){E="NEWLINE"}else{if(G==="TK_SEMICOLON"&&O==="EXPRESSION"){E="SPACE"}else{if(G==="TK_STRING"){E="NEWLINE"}else{if(G==="TK_WORD"){E="SPACE"}else{if(G==="TK_START_BLOCK"){E="NEWLINE"}else{if(G==="TK_END_EXPR"){i();E="NEWLINE"}}}}}}}if(G!=="TK_END_BLOCK"&&C(o.toLowerCase(),["else","catch","finally"])){v()}else{if(C(o,q)||E==="NEWLINE"){if(k==="else"){i()}else{if((G==="TK_START_EXPR"||k==="=")&&o==="function"){}else{if(G==="TK_WORD"&&(k==="return"||k==="throw")){i()}else{if(G!=="TK_END_EXPR"){if((G!=="TK_START_EXPR"||o!=="var")&&k!==":"){if(o==="if"&&G==="TK_WORD"&&u==="else"){i()}else{v()}}}else{if(C(o,q)&&k!==")"){v()}}}}}}else{if(E==="SPACE"){i()}}}A();u=o;if(o==="var"){y=true;h=false}if(o==="if"||o==="else"){e=true}break;case"TK_SEMICOLON":A();y=false;break;case"TK_STRING":if(G==="TK_START_BLOCK"||G==="TK_END_BLOCK"||G=="TK_SEMICOLON"){v()}else{if(G==="TK_WORD"){i()}}A();break;case"TK_OPERATOR":var b=true;var c=true;if(y&&o!==","){h=true;if(o===":"){y=false}}if(y&&o===","&&O==="EXPRESSION"){h=false}if(o===":"&&N){A();v();break}if(o==="::"){A();break}N=false;if(o===","){if(y){if(h){A();v();h=false}else{A();i()}}else{if(G==="TK_END_BLOCK"){A();v()}else{if(O==="BLOCK"){A();v()}else{A();i()}}}break}else{if(o==="--"||o==="++"){if(k===";"){b=true;c=false}else{b=false;c=false}}else{if(o==="!"&&G==="TK_START_EXPR"){b=false;c=false}else{if(G==="TK_OPERATOR"){b=false;c=false}else{if(G==="TK_END_EXPR"){b=true;c=true}else{if(o==="."){b=false;c=false}else{if(o===":"){if(k.match(/^\d+$/)){b=true}else{b=false}}}}}}}}if(b){i()}A();if(c){i()}break;case"TK_BLOCK_COMMENT":v();A();v();break;case"TK_COMMENT":i();A();v();break;case"TK_UNKNOWN":A();break}G=J;k=o}return w.join("")};